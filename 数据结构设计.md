# [380. O(1) 时间插入、删除和获取随机元素](https://leetcode.cn/problems/insert-delete-getrandom-o1/)
思考：
- 模仿`{val: id}`, 
- 难点在于删除时候: 把需要删除的点移动到stack末端，然后pop掉
```python fold
class RandomizedSet:

    def __init__(self):
        self.num2id = defaultdict(int)
        self.stack = []

    def insert(self, val: int) -> bool:
        if val in self.num2id:
            return False
        self.num2id[val] = len(self.stack)
        self.stack.append(val)
        return True

    def remove(self, val: int) -> bool:
        if val not in self.num2id:
            return False
        lastid = len(self.stack)-1
        val_ori_id = self.num2id[val]
        # 如果val本身就是最后一个数字，直接pop
        if val_ori_id == lastid:
            self.stack.pop(-1)
            del self.num2id[val]
        # 否则，先在stack中交换一下二者
        else:
            self.stack[lastid], self.stack[val_ori_id] = self.stack[val_ori_id], self.stack[lastid]
            # 删除num2id中的记录
            del self.num2id[val]
            self.stack.pop(-1)
            # 给原来的lastid对应的数在num2id中重新注册(用老牌照)
            self.num2id[self.stack[val_ori_id]] = val_ori_id
        return True

    def getRandom(self) -> int:
        import random
        return random.choice(self.stack)
```
# [381. O(1) 时间插入、删除和获取随机元素 - 允许重复](https://leetcode.cn/problems/insert-delete-getrandom-o1-duplicates-allowed/)
```python fold
class RandomizedCollection:

    def __init__(self):
        self.num2id = defaultdict(set)
        self.stack = []

    def insert(self, val: int) -> bool:
        flag = val not in self.num2id
        self.num2id[val].add(len(self.stack))
        self.stack.append(val)
        return flag

    def remove(self, val: int) -> bool:
        if val not in self.num2id:
            return False
        lastid = len(self.stack)-1
        lastv = self.stack[-1]
        val_ori_id = self.num2id[val].pop()
        # 如果val本身就是最后一个数字，直接pop
        if val_ori_id == lastid:
            self.stack.pop()
        # 否则，先在stack中交换一下二者
        else:
            self.stack[lastid], self.stack[val_ori_id] = val, lastv
            # 删除num2id中的记录
            self.stack.pop()
            # 给原来lastv在num2id中吊销老牌照(lastid)，用上新牌照(val_ori_id)
            self.num2id[lastv].remove(lastid)
            self.num2id[lastv].add(val_ori_id)
        
        if len(self.num2id[val])==0:
            del self.num2id[val]
        return True

    def getRandom(self) -> int:
        import random
        return random.choice(self.stack)
```
